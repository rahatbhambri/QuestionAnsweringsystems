<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Searchy
    </title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Pacifico&display=swap" rel="stylesheet">
</head>

<body style="background-color : #ADD8E6; font-family: 'Pacifico', cursive;">
<div id="app" class="column justify-content-center container mt-3 bg-gradient-light border border-primary rounded">
    <h1 class = "font-weight-bold text-center container" id="phead">
        Searchy
        <img class="img-fluid mx-auto" id ="searchy" src="{{ url_for('static', filename='fish.gif') }}">    
    </h1>
    
    <div class="sidebar bg-gradient-light border border-primary rounded">
        <ul>
          <li><router-link to="/">Session 1</router-link></li>
          <li><router-link to="/about">Session 2</router-link></li>
          </ul>
    </div>

    <div id="all_chats" class="container-fluid">
        <div class = "container mt-3 bg-gradient-light border border-primary alert alert-primary" >
            <ul >
                <li v-for="chat in chats" :key="chat.question" class="d-flex" style="border: 0.1in solid darkblue; background-color = #ADD8E6;"> 
                    <img :src="chat.img" id="curr_img" class="img-fluid">
                    <p class="alert alert-primary">
                        <strong> Q: </strong> [[ chat.question ]] 
                        <br>
                        <strong>Answer : </strong> [[ chat.answer ]] 
                    </p> 
                    <br>
                </li>
                <br>
            </ul>
        </div> 

        <div v-if="answer_received" class="d-flex">
            <img :src="img" id="curr_img" class="img-fluid">
            <p class="alert alert-primary">
                <strong>Q: </strong>  [[ this.question ]]
                <br>
                <strong>Answer : </strong> [[ this.answer ]] 
                <span class="blinking-cursor">|</span> .
            </p> 
        </div> 
    </div>
    <br>

    <div id="asker" class="column justify-content-center">
        <form @submit.prevent  style="margin-top: 15px;">
            <input id="question" style="width: 600px;" v-model="curr_question" placeholder="Ask me anything">
            <button type="submit" @click="getAnswer()" class="btn btn-primary"> Ask a question </button>
        </form>
        <br>
    </div>
</div>






<style>
    #searchy {
        width : 1in ;
        height : 1in ;
        display: inline; 
        vertical-align: middle; 
    }

    #app {
        margin: 0 auto;
        width: 1100px;
        height: 700px;
        background-color: aqua;
        // border: 0.1in solid darkblue; 
        flex-flow: row wrap;
        /* Enable vertical scrollbar */
    }
    #all_chats{
        overflow: auto; 
        width : 1000px;
        height: 500px ;
        background-color: blue ;
    }
    #phead {
        background-color: blue ;
        color : white ;
        border: 0.05in solid #ADD8E6; 

    }
    #curr_img {
        width : 300px ;
        height : 300px ;
        border: 0.05in solid black; 

    }
    hr {
        border: 2px solid darkblue;
    }
    .blinking-cursor {
        margin-left: 5px;
        background-color: #fff;
        animation: blink 1s infinite;
    }
    @keyframes blink {
        0%, 50% {
            opacity: 1;
        }
        50.1%, 100% {
            opacity: 0;
        }
    }
    #answer{
        overflow-y: auto;
    }
    .sidebar {
        background-color: orange;
        //border: 0.1in solid red; 
        width: 200px;
        padding: 10px;
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
      }
      #asker{
        position: fixed;
        margin-bottom: 0px ;
        margin-left: 100px; 
      }
</style>    

    
<script>
    //import Sidebar from './sidebar.vue';

    new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        /* components: {
            Sidebar,
        }, */
        data: {
            question : null,
            curr_question : null,
            answer_received : false,
            answer : null,
            img : null, 
            chats : [],
            last_chat : null
        },
        methods: {
            async getAnswer(){
                if (this.last_chat !== null){
                    this.chats.push(this.last_chat) ;
                }
                //console.log('Server response:'.data);
                this.answer_received = false ;
                this.question = this.curr_question ;
                const data = {"question": this.question}
                const response = await axios.get('/answer', {
                    params: data
                });               
                this.answer_received = true ;
                const text = response.data['answer'] ;
                this.img = response.data['img']
                // console.log('Server response:', response.data);
                // console.log('Question submitted:', this.question);
                let index = 0;
                const startTyping = () => {

                    if (index < text.length) {
                        this.answer = text.slice(0, index + 1); // Updated to include the current character
                        index++;
                        setTimeout(startTyping, Math.random()*15 + 10);
                    }else {
                      this.answer = text;
                    }  
                };

                this.last_chat = {
                    'question' : this.question, 
                    'answer' : text, 
                    'img' : this.img,
                    'timestamp' : new Date().toLocaleString()
                }
                  
                startTyping();
                console.log(this.chats) ;
            }, 
            scrollToBottom() {
                const scrollableDiv = this.$refs.scrollableDiv;
                scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
            }
        }
    });

   

</script>



</body>
</html>


